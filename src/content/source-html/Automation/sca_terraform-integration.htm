<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head>
        <link href="../Resources/TableStyles/Standard.css" rel="stylesheet" MadCap:stylesheetType="table" />
    </head>
    <body>
        <map id="map1">
            <area shape="rectangle" coords="77,677,373,821" dragDirection="0" href="#Discover" />
            <area shape="rectangle" coords="541,675,821,817" dragDirection="0" href="#Connect" />
            <area shape="rectangle" coords="1015,679,1307,819" dragDirection="0" href="#Connect2" />
        </map>
        <map id="map2">
            <area shape="rectangle" coords="79,677,369,813" dragDirection="0" href="#Discover" />
            <area shape="rectangle" coords="533,667,831,823" dragDirection="0" href="#Connect" />
            <area shape="rectangle" coords="1019,663,1313,815" dragDirection="0" href="#Connect2" />
        </map>
        <h1>Automate onboarding and policy creation with Terraform</h1>
        <p>This topic describes how to integrate Terraform with <MadCap:variable name="cc_product_vars.SCA-short" />, in order to automate the process of onboarding cloud workspaces and creating access policies for the identities that need to manage the workspaces. </p>
        <h2>Overview</h2>
        <p>Cloud environments are dynamic, and many organizations add new workspaces on a regular basis.</p>
        <p>If you already use Terraform to onboard new workspaces to your cloud environment, you can add <MadCap:variable name="cc_product_vars.SCA-short" /> onboarding to your existing automation. This will ensure that the new workspaces have <MadCap:variable name="cc_product_vars.SCA-short" /> policies in place with zero standing permissions as soon as they are added to your cloud environment.</p>
        <div class="note">
            <p><MadCap:variable name="cc_product_vars.SCA-short" /> supports using automation to add workspaces to organizations and directories that were previously onboarded to <MadCap:variable name="cc_product_vars.SCA-short" /> using <MadCap:variable name="cc_product_vars.CEM-short" />.</p>
        </div>
        <p>Perform the procedures described in this topic for both first-time integrations and upgrades.</p>
        <h2>Supported workspace scopes</h2>
        <p>The Terraform integration with <MadCap:variable name="cc_product_vars.SCA-short" /> supports the following cloud workspace scopes.</p>
        <table style="mc-table-style: url('../Resources/TableStyles/Standard.css');caption-side: top;width: 100%;" class="TableStyle-Standard" cellspacing="0" summary="Lists the workspace scopes that can be automated for discovery and policy creation with SCA">
            <caption>Supported workspace scopes</caption>
            <col class="TableStyle-Standard-Column-Column1" />
            <col class="TableStyle-Standard-Column-Column1" />
            <thead>
                <tr class="TableStyle-Standard-Head-Header1">
                    <th class="TableStyle-Standard-HeadE-Column1-Header1">
                        <p>Cloud provider</p>
                    </th>
                    <th class="TableStyle-Standard-HeadD-Column1-Header1">
                        <p>Workspace scopes</p>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr class="TableStyle-Standard-Body-Body1">
                    <td class="TableStyle-Standard-BodyE-Column1-Body1">
                        <p>AWS</p>
                    </td>
                    <td class="TableStyle-Standard-BodyD-Column1-Body1">
                        <p>New organization</p>
                        <p>Account (to an existing organization)</p>
                        <p>Standalone AWS account</p>
                    </td>
                </tr>
                <tr class="TableStyle-Standard-Body-Body1">
                    <td class="TableStyle-Standard-BodyE-Column1-Body1">
                        <p>Azure</p>
                    </td>
                    <td class="TableStyle-Standard-BodyD-Column1-Body1">
                        <p>Directory (root management group)</p>
                        <p>Management group</p>
                        <p>Subscription</p>
                        <p>Resource group</p>
                        <p>Resource</p>
                    </td>
                </tr>
                <tr class="TableStyle-Standard-Body-Body1">
                    <td class="TableStyle-Standard-BodyB-Column1-Body1">
                        <p>Google Cloud</p>
                    </td>
                    <td class="TableStyle-Standard-BodyA-Column1-Body1">
                        <p>Organization</p>
                        <p>Folder</p>
                        <p>Project</p>
                    </td>
                </tr>
            </tbody>
        </table>
        <h2>Before you begin</h2>
        <p>Make sure you have the following:</p>
        <ul>
            <li>
                <p>Terraform installed in your environment, as described in the <a href="https://developer.hashicorp.com/terraform/tutorials/aws-get-started/install-cli" target="_blank" alt="Link to Hashicorp documentation on installing Terraform">Terraform docs</a></p>
            </li>
            <li>
                <p>An <MadCap:variable name="cc_product_vars.SCA-short" /> service user and appropriate authorization configuration, as described in <MadCap:xref href="sca_API-prerequisite.htm">[%=cc_product_vars.ISP-short%] authentication prerequisites</MadCap:xref></p>
            </li>
        </ul>
        <h2 class="step" MadCap:autonum="Step 1: ">Prepare the template file </h2>
        <p>The Terraform template file contains all the assets you need to integrate <MadCap:variable name="cc_product_vars.SCA-short" /> with your Terraform deployment.</p>
        <div class="note" MadCap:conditions="cc_C_CyberArk.NOT_TO_PUBLISH">
            <p>The current <MadCap:variable name="cc_product_vars.SCA-short" /> Terraform template version is 1.0.0.</p>
        </div>
        <h3 class="step" MadCap:autonum="Step 1: ">Download the Terraform template files</h3>
        <p>Go to <span class="Emphasis">Settings</span> &gt;<span class="Emphasis"> Integrations</span> and click the <span class="Emphasis">Terraform</span> tile.</p>
        <ol>
            <li>
                <p>In the <span class="Emphasis">Download Terraform template</span> window, select the operating system of the machine you're using to configure the integration and then click <span class="Emphasis">Download</span>.</p>
            </li>
            <li>
                <p>Unzip the <span class="Emphasis">terraform-provider-sca_&lt;OS&gt;.zip</span> file that you downloaded, which contains the following folders:</p>
                <table style="width: 100%;mc-table-style: url('../Resources/TableStyles/Standard.css');" class="TableStyle-Standard" cellspacing="0" summary="contents of the zip file">
                    <caption>Terraform download</caption>
                    <col class="TableStyle-Standard-Column-Column1">
                    </col>
                    <col class="TableStyle-Standard-Column-Column1">
                    </col>
                    <thead>
                        <tr class="TableStyle-Standard-Head-Header1">
                            <th class="TableStyle-Standard-HeadE-Column1-Header1">
                                <p>Folder</p>
                            </th>
                            <th class="TableStyle-Standard-HeadD-Column1-Header1">
                                <p>Description</p>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="TableStyle-Standard-Body-Body1">
                            <td class="TableStyle-Standard-BodyE-Column1-Body1">
                                <p><span class="Emphasis">terrafrom-provider-sca</span>
                                </p>
                            </td>
                            <td class="TableStyle-Standard-BodyD-Column1-Body1">
                                <p>Contains all the resources you need to implement the <MadCap:variable name="cc_product_vars.SCA-short" /> integration with Terraform for AWS, Azure, and Google Cloud</p>
                            </td>
                        </tr>
                        <tr class="TableStyle-Standard-Body-Body1">
                            <td class="TableStyle-Standard-BodyE-Column1-Body1">
                                <p><span class="Emphasis">main.tf</span>
                                </p>
                            </td>
                            <td class="TableStyle-Standard-BodyD-Column1-Body1">
                                <p>Contains the template file for integrating Terraform with <MadCap:variable name="cc_product_vars.SCA-short" /> on the cloud provider</p>
                            </td>
                        </tr>
                        <tr class="TableStyle-Standard-Body-Body1">
                            <td class="TableStyle-Standard-BodyB-Column1-Body1">
                                <p><span class="Emphasis">variables.tf</span>
                                </p>
                            </td>
                            <td class="TableStyle-Standard-BodyA-Column1-Body1">
                                <p>Apply the parameter values in this file so that they are available when you run <span class="Emphasis">main.tf</span></p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </li>
        </ol>
        <h3 class="step" MadCap:autonum="Step 2: ">Move the binary to the Terraform plugins folder</h3>
        <p>After you unzip the file, you have to move the binary files to the location that Terraform uses when it runs. </p>
        <div class="note">
            <p>If this is your first plugin, you may have to create this folder (if Terraform didn't create the folder when it was installed).</p>
        </div>
        <div class="tabs">
            <ul class="tabs-nav">
                <li class="tab-active"><a data-cc-tab=".tab-1">Windows</a>
                </li>
                <li><a data-cc-tab=".tab-2">Linux</a>
                </li>
                <li><a data-cc-tab=".tab-3">Darwin (Mac)</a>
                </li>
            </ul>
            <div class="tabs-stage">
                <div class="tab-1">
                    <p MadCap:conditions="cc_C_CyberArk.InternalOnly">Tab 1 Content - &lt;Windows&gt;</p>
                    <ol>
                        <li>
                            <p>Confirm that you have a 64-bit installation: run <code> terraform --version</code> and verify that the output includes <code>amd64</code>.</p>
                        </li>
                        <li>
                            <p>Create a sub-directory within the user plugins directory for the HashiCups provider, replacing &lt;<span class="Italics">current version</span>&gt; with the <MadCap:variable name="cc_product_vars.SCA-short" /> provider version number and &lt;<span class="Italics">OS</span>&gt; with your Windows version, for example <span class="Emphasis">windows_amd64</span>.</p>
                            <div class="code" MadCap:conditions="cc_C_CyberArk.NOT_TO_PUBLISH"><pre><code>mkdir  %USERPROFILE%\AppData\Roaming\terraform.d\plugins\cyberark\terraform-provider-sca\sca\&lt;<span class="Italics">current version</span>&gt;\&lt;<span class="Italics">OS</span>&gt;</code></pre>
                            </div>
                            <div class="code"><pre><code>mkdir&#160;&#160;%USERPROFILE%\AppData\Roaming\terraform.d\plugins\cyberark\sca\sca\&lt;<span class="Italics">current version</span>&gt;\&lt;<span class="Italics">OS</span>&gt;</code></pre>
                            </div>
                        </li>
                        <li>
                            <p> Move the binary file to the sub-directory that you created in the previous step.</p>
                            <div class="code" MadCap:conditions="cc_C_CyberArk.NOT_TO_PUBLISH"><pre><code>move terraform-provider-sca_&lt;OS&gt; %USERPROFILE%\AppData\Roaming\terraform.d\plugins\cyberark\terraform-provider-sca\sca\&lt;<span class="Italics">current version</span>&gt;\&lt;<span class="Italics">OS</span>&gt;</code></pre>
                            </div>
                            <div class="code"><pre><code>move&#160;terraform-provider-sca_&lt;<span class="Italics">OS</span>&gt;&#160;%USERPROFILE%\AppData\Roaming\terraform.d\plugins\cyberark\sca\sca\&lt;<span class="Italics">current version</span>&gt;\&lt;<span class="Italics">OS</span>&gt;</code></pre>
                            </div>
                        </li>
                        <li>
                            <p>Rename the file to have a <code>.exe</code> extension.</p>
                        </li>
                    </ol>
                    <div class="note">
                        <p>Depending on your organization's security requirements, modify the properties of the plugin binary file to mark it as safe to use.</p>
                    </div>
                </div>
                <div class="tab-2">
                    <p MadCap:conditions="cc_C_CyberArk.InternalOnly">Tab 2 Content - &lt;Linux&gt;</p>
                    <ol>
                        <li MadCap:conditions="cc_C_CyberArk.NOT_TO_PUBLISH">
                            <p>Retrieve your system's OS and ARCH.</p>
                            <div class="code"><pre><code>export OS_ARCH="$(go env GOHOSTOS)_$(go env GOHOSTARCH)"</code></pre>
                            </div>
                        </li>
                        <li>
                            <p>Create a sub-directory within the user plugins directory for the HashiCups provider, replacing &lt;<span class="Italics">current version</span>&gt; with the <MadCap:variable name="cc_product_vars.SCA-short" /> provider version number and &lt;<span class="Italics">OS</span>&gt; with your operating system version, for example <span class="Emphasis">linux_amd64</span>.</p>
                            <div class="code" MadCap:conditions="cc_C_CyberArk.NOT_TO_PUBLISH"><pre><code>mkdir -p ~/.terraform.d/plugins/cyberark/terraform-provider-sca/sca/<span class="Italics">&lt;current version&gt;</span>/&lt;<span class="Italics">OS</span>&gt;</code></pre>
                            </div>
                            <div class="code"><pre><code>mkdir -p ~/.terraform.d/plugins/cyberark/sca/sca/<span class="Italics">&lt;current version&gt;</span>/&lt;<span class="Italics">OS</span>&gt;</code></pre>
                            </div>
                        </li>
                        <li>
                            <p>Move the binary file to the sub-directory that you created in the previous step. </p>
                            <div class="code" MadCap:conditions="cc_C_CyberArk.NOT_TO_PUBLISH"><pre><code>mv terraform-provider-sca_&lt;<span class="Italics">OS</span>&gt; ~/.terraform.d/plugins/cyberark/terraform-provider-sca/sca/&lt;<span class="Italics">current version</span>&gt;/&lt;<span class="Italics">OS</span>&gt;/terraform-provider-sca</code></pre>
                            </div>
                            <div class="code"><pre><code>mv terraform-provider-sca_&lt;<span class="Italics">OS</span>&gt; ~/.terraform.d/plugins/cyberark/sca/sca/&lt;<span class="Italics">current version</span>&gt;/&lt;<span class="Italics">OS</span>&gt;/terraform-provider-sca</code></pre>
                            </div>
                        </li>
                    </ol>
                </div>
                <div class="tab-3">
                    <p MadCap:conditions="cc_C_CyberArk.InternalOnly">Tab 3 Content - &lt;Darwin/Mac&gt;</p>
                    <p MadCap:conditions="cc_C_CyberArk.NOT_TO_PUBLISH">When you copy the binary to your plugins folder, you have to rename it so Terraform will be able to access it.</p>
                    <ol>
                        <li>
                            <p>Create a sub-directory within the user plugins directory for the HashiCups provider, replacing &lt;<span class="Italics">current version</span>&gt; with the <MadCap:variable name="cc_product_vars.SCA-short" /> provider version number.</p>
                            <div class="code" MadCap:conditions="cc_C_CyberArk.NOT_TO_PUBLISH"><pre><code>mkdir -p ~/.terraform.d/plugins/cyberark/terraform-provider-sca/sca/&lt;<span class="Italics">current version</span>&gt;/darwin_amd64</code></pre>
                            </div>
                            <div class="code"><pre><code>mkdir -p ~/.terraform.d/plugins/cyberark/sca/sca/&lt;<span class="Italics">current version</span>&gt;/darwin_amd64</code></pre>
                            </div>
                        </li>
                        <li>
                            <p>Rename the <span class="Emphasis">terraform-provider-sca_darwin_amd64 </span>file to <span class="Emphasis">terraform-provider-sca </span>and move it to the plugins folder.</p>
                            <div class="code" MadCap:conditions="cc_C_CyberArk.NOT_TO_PUBLISH"><pre><code>mv terraform-provider-sca_darwin_amd64 ~/.terraform.d/plugins/cyberark/sca/sca/&lt;<span class="Italics">current version</span>&gt;/darwin_amd64/terraform-provider-sca</code></pre>
                            </div>
                            <div class="code"><pre><code>mv&#160;terraform-provider-sca_darwin_amd64&#160;~/.terraform.d/plugins/cyberark/sca/sca/&lt;<span class="Italics">current&#160;version</span>&gt;/&lt;<span class="Italics">OS</span>&gt;/terraform-provider-sca</code></pre>
                            </div>
                        </li>
                    </ol>
                </div>
            </div>
        </div>
        <div>
            <h2 class="step" MadCap:autonum="Step 2: ">Apply the <MadCap:variable name="cc_C_CyberArk.CompanyName" /> and cloud provider information</h2>
            <p>Specify the cloud identities and cloud provider information in your Terraform deployment to enable <MadCap:variable name="cc_product_vars.SCA-short" /> to automate onboarding and policy creation. Define the parameters in the <span class="Emphasis">variables.tf</span> file, which are used by the <span class="Emphasis">main.tf</span> file when it is run.</p>
            <div class="tip">
                <p>The <MadCap:variable name="cc_product_vars.SCA-short" />-Terraform template version is available in the <span class="Emphasis">main.tf</span> file.</p>
            </div>
            <p>The variables.tf file contains the variables described in the subsections below.</p>
            <h3>sca_provider</h3>
            <p>The parameters in the <code>sca_provider</code> section are required for any automation that you want to configure.</p>
            <table style="mc-table-style: url('../Resources/TableStyles/Standard.css');margin-left: 0;margin-right: auto;caption-side: top;width: 100%;" class="TableStyle-Standard" cellspacing="0" summary="Lists the sca_provider variables in the variables.tf file that should have values">
                <caption>sca_provider variables</caption>
                <col class="TableStyle-Standard-Column-Column1" />
                <col class="TableStyle-Standard-Column-Column1" />
                <thead>
                    <tr class="TableStyle-Standard-Head-Header1">
                        <th class="TableStyle-Standard-HeadE-Column1-Header1">
                            <p>Variable</p>
                        </th>
                        <th class="TableStyle-Standard-HeadD-Column1-Header1">
                            <p>Description</p>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="TableStyle-Standard-Body-Body1">
                        <td class="TableStyle-Standard-BodyE-Column1-Body1">
                            <p><span class="Emphasis">auth_url</span>
                            </p>
                        </td>
                        <td class="TableStyle-Standard-BodyD-Column1-Body1">
                            <p>OAuth2 URL for authenticating from <MadCap:variable name="cc_product_vars.Identity-full" /></p>
                        </td>
                    </tr>
                    <tr class="TableStyle-Standard-Body-Body1">
                        <td class="TableStyle-Standard-BodyE-Column1-Body1">
                            <p><span class="Emphasis">tenant_domain_name</span>
                            </p>
                        </td>
                        <td class="TableStyle-Standard-BodyD-Column1-Body1">
                            <p>The tenant subdomain, which is the same as <span class="Emphasis">tenant_name</span> in the SCA REST API, for example, see <MadCap:xref href="sca-API-infrastructure.htm" class="ParaTextOnly">[%=cc_product_vars.SCA-short%] infrastructure APIs</MadCap:xref>.</p>
                            <p>For example, if your tenant URL is <span class="Emphasis">abc1234.cyberark.cloud</span>, then specify <span class="Emphasis">abc1234</span>.</p>
                            <div class="note">
                                <p>If you downloaded the Terraform template files before 16 October 2024, the value of <span class="Emphasis">tenant_domain_name</span> must be in the format <span class="Emphasis">&lt;tenant_name&gt;-sca</span>. For example, if your tenant URL is <span class="Emphasis">abc1234.cyberark.cloud</span>, then specify <code>tenant_domain_name = abc1234-sca</code>.</p>
                            </div>
                        </td>
                    </tr>
                    <tr class="TableStyle-Standard-Body-Body1">
                        <td class="TableStyle-Standard-BodyE-Column1-Body1">
                            <p><span class="Emphasis">platform_domain_name</span>
                            </p>
                        </td>
                        <td class="TableStyle-Standard-BodyD-Column1-Body1">
                            <p>The platform domain</p>
                            <p>Default:&#160;<span class="Emphasis">cyberark.cloud</span></p>
                        </td>
                    </tr>
                    <tr class="TableStyle-Standard-Body-Body1">
                        <td class="TableStyle-Standard-BodyE-Column1-Body1">
                            <p><span class="Emphasis">username</span>
                            </p>
                        </td>
                        <td class="TableStyle-Standard-BodyD-Column1-Body1">
                            <p><MadCap:variable name="cc_product_vars.SCA-short" /> service user username for the API</p>
                        </td>
                    </tr>
                    <tr class="TableStyle-Standard-Body-Body1">
                        <td class="TableStyle-Standard-BodyE-Column1-Body1">
                            <p><span class="Emphasis">password</span>
                            </p>
                        </td>
                        <td class="TableStyle-Standard-BodyD-Column1-Body1">
                            <p>Password used by the <MadCap:variable name="cc_product_vars.SCA-short" /> service user for the API</p>
                        </td>
                    </tr>
                    <tr class="TableStyle-Standard-Body-Body1">
                        <td class="TableStyle-Standard-BodyB-Column1-Body1">
                            <p><span class="Emphasis">debug</span>
                            </p>
                        </td>
                        <td class="TableStyle-Standard-BodyA-Column1-Body1">
                            <p>Use this parameter to turn debug mode on or off for the resources and data source</p>
                            <p>Default: <span class="Emphasis">false</span></p>
                        </td>
                    </tr>
                </tbody>
            </table>
            <h4>Example</h4>
            <p>In this example of the <code>sca_provider</code> section in the main.tf file, the tenant URL is <code>example.cyberark.cloud</code>.</p>
            <div class="example"><pre><code>provider "sca" {
  auth_url             = "https://{identity_tenant}.id.cyberark.cloud/oauth2/token/{webapp}"
  tenant_domain_name   = "abc1234"
  platform_domain_name = "cyberark.cloud"
  username             = "service_username@cyberark.cloud.xxx"
  password             = "service_username_password"
  debug                = true
}</code></pre>
            </div>
        </div>
        <h3>sca_discovery</h3>
        <p>The variables in the <code>sca_discovery</code> data section are used to automate onboarding new workspaces or roles. If you don't want to automate this activity, you can delete the section in the variables.tf file.</p>
        <table style="mc-table-style: url('../Resources/TableStyles/Standard.css');margin-left: 0;margin-right: auto;caption-side: top;width: 100%;" class="TableStyle-Standard" cellspacing="0" summary="The sca_discovery variables that need values if you're onboarding workspaces">
            <caption>sca_discovery variables</caption>
            <col class="TableStyle-Standard-Column-Column1" />
            <col class="TableStyle-Standard-Column-Column1" />
            <thead>
                <tr class="TableStyle-Standard-Head-Header1">
                    <th class="TableStyle-Standard-HeadE-Column1-Header1">
                        <p>Variable</p>
                    </th>
                    <th class="TableStyle-Standard-HeadD-Column1-Header1">
                        <p>Description</p>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr class="TableStyle-Standard-Body-Body1">
                    <td class="TableStyle-Standard-BodyE-Column1-Body1">
                        <p><span class="Emphasis">csp</span>
                        </p>
                    </td>
                    <td class="TableStyle-Standard-BodyD-Column1-Body1">
                        <p>Cloud service provider</p>
                        <p>Supported values:</p>
                        <ul>
                            <li>
                                <p><span class="Emphasis">AWS</span>
                                </p>
                            </li>
                            <li>
                                <p><span class="Emphasis">GCP</span>
                                </p>
                            </li>
                            <li>
                                <p><span class="Emphasis">AZURE</span>
                                </p>
                            </li>
                        </ul>
                        <div class="note" MadCap:conditions="cc_C_CyberArk.NOT_TO_PUBLISH">
                            <p>This information is needed to automate both onboarding new workspaces and creating <MadCap:variable name="cc_product_vars.SCA-short" /> policies.</p>
                        </div>
                    </td>
                </tr>
                <tr class="TableStyle-Standard-Body-Body1">
                    <td class="TableStyle-Standard-BodyE-Column1-Body1">
                        <p><span class="Emphasis">organization_id</span>
                        </p>
                    </td>
                    <td class="TableStyle-Standard-BodyD-Column1-Body1">
                        <p>Root organization ID&#160;for the cloud provider workspace to which the policy applies</p>
                    </td>
                </tr>
                <tr class="TableStyle-Standard-Body-Body1">
                    <td class="TableStyle-Standard-BodyB-Column1-Body1">
                        <p><span class="Emphasis">account_info</span>
                        </p>
                    </td>
                    <td class="TableStyle-Standard-BodyA-Column1-Body1">
                        <p>A dictionary with the following parameters:</p>
                        <ul>
                            <li>
                                <p><span class="Emphasis">workspace_id </span>- ID&#160;of the scope (account, project, subscription, etc.) to which the policy applies</p>
                            </li>
                            <li>
                                <p><span class="Emphasis">new_account </span>- indicates whether the account is new to an organization, and has not yet been onboarded. Supported values:</p>
                                <ul>
                                    <li>
                                        <p><span class="Emphasis">false</span> (default) - indicates that the account is not new - it was previously onboarded</p>
                                    </li>
                                    <li>
                                        <p><span class="Emphasis">true</span> - indicates the account is new to the organization, meaning that you're onboarding a new:</p>
                                        <ul>
                                            <li>
                                                <p>AWS account that belongs to an already onboarded AWS organization</p>
                                            </li>
                                            <li>
                                                <p>GCP project  that belongs to an already onboarded Google&#160;Cloud organization</p>
                                            </li>
                                            <li>
                                                <p>Management group / subscription / resource group  that belongs to an already onboarded <MadCap:variable name="cv-shared-variables.entra-id-long" /> directory.</p>
                                            </li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </td>
                </tr>
            </tbody>
        </table>
        <h4>Example</h4>
        <p>In this example, the AWS&#160;account 11111111, which belongs to the r-xxx organization, is new and is being onboarded.</p>
        <p>The sca_discovery section in the main.tf file looks as follows:</p>
        <div class="example"><pre><code>data "sca_discovery" "discovery_example" {
  csp = "AWS
  organization_id = "r-xxxx"
  account_info = {
    id = "1111111111"
    new_account = false</code></pre>
        </div>
        <h3><a name="sca_policy"></a>sca_policy</h3>
        <p>The variables in the <code>sca_policy</code> section are used to create <MadCap:variable name="cc_product_vars.SCA-short" /> policies. If you don't want to automate this activity, you can delete the section in the variables.tf file.</p>
        <table style="mc-table-style: url('../Resources/TableStyles/Standard.css');margin-left: 0;margin-right: auto;caption-side: top;width: 100%;" class="TableStyle-Standard" cellspacing="0" summary="The variables in that should have values if you are automatingthe  creation of SCA policies">
            <caption>sca_policy variables</caption>
            <col class="TableStyle-Standard-Column-Column1" />
            <col class="TableStyle-Standard-Column-Column1" />
            <thead>
                <tr class="TableStyle-Standard-Head-Header1">
                    <th class="TableStyle-Standard-HeadE-Column1-Header1">
                        <p>Variable</p>
                    </th>
                    <th class="TableStyle-Standard-HeadD-Column1-Header1">
                        <p>Description</p>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr class="TableStyle-Standard-Body-Body1">
                    <td class="TableStyle-Standard-BodyE-Column1-Body1">
                        <p><span class="Emphasis">name</span>
                        </p>
                    </td>
                    <td class="TableStyle-Standard-BodyD-Column1-Body1">
                        <p>The name of the policy.</p>
                    </td>
                </tr>
                <tr class="TableStyle-Standard-Body-Body1">
                    <td class="TableStyle-Standard-BodyE-Column1-Body1">
                        <p><span class="Emphasis">description</span>
                        </p>
                    </td>
                    <td class="TableStyle-Standard-BodyD-Column1-Body1">
                        <p>The description of the policy.</p>
                    </td>
                </tr>
                <tr class="TableStyle-Standard-Body-Body1">
                    <td class="TableStyle-Standard-BodyE-Column1-Body1">
                        <p><span class="Emphasis">csp</span>
                        </p>
                    </td>
                    <td class="TableStyle-Standard-BodyD-Column1-Body1">
                        <p>Cloud service provider</p>
                        <p>Supported values:</p>
                        <ul>
                            <li>
                                <p><span class="Emphasis">AWS</span>
                                </p>
                            </li>
                            <li>
                                <p><span class="Emphasis">GCP</span>
                                </p>
                            </li>
                            <li>
                                <p><span class="Emphasis">AZURE</span>
                                </p>
                            </li>
                        </ul>
                        <div class="note" MadCap:conditions="cc_C_CyberArk.NOT_TO_PUBLISH">
                            <p>This information is needed to automate both onboarding new workspaces and creating <MadCap:variable name="cc_product_vars.SCA-short" /> policies.</p>
                        </div>
                    </td>
                </tr>
                <tr class="TableStyle-Standard-Body-Body1">
                    <td class="TableStyle-Standard-BodyE-Column1-Body1" rowspan="4">
                        <p><span class="Emphasis">roles</span>
                        </p>
                    </td>
                    <td class="TableStyle-Standard-BodyD-Column1-Body1">
                        <p>Cloud provider roles to which the policy applies, defined by the following:</p>
                    </td>
                </tr>
                <tr class="TableStyle-Standard-Body-Body1">
                    <td class="TableStyle-Standard-BodyD-Column1-Body1">
                        <p><span class="Emphasis">entity_id</span>
                        </p>
                        <ul>
                            <li>
                                <p>AWS - the cloud role ARN (for example,  arn:aws:iam::&lt;<span class="Italics">AWS&#160;account ID</span>&gt;:role/devOps)</p>
                            </li>
                            <li>
                                <p>Google Cloud - cloud role name and hierarchy structure (for example, projects/cybrsca-dev/roles/CustomRole)</p>
                            </li>
                            <li>
                                <p>Azure RBAC - path of the roleDefinition in Azure (for example, <span class="Wrap">/subscriptions/xxxxxxx/providers/Microsoft.Authorization/roleDefinitions/&lt;roleDefinition&gt;</span>)</p>
                            </li>
                            <li>
                                <p><MadCap:variable name="cv-shared-variables.entra-id-long" /> - the unique identifier of the cloud role (a GUID)</p>
                            </li>
                        </ul>
                    </td>
                </tr>
                <tr class="TableStyle-Standard-Body-Body1">
                    <td class="TableStyle-Standard-BodyD-Column1-Body1">
                        <p><span class="Emphasis">entity_source_id</span> </p>
                        <ul>
                            <li>
                                <p>AWS - the account ID associated with the role (in format &lt;XXXXXXXXXXXX&gt;)</p>
                            </li>
                            <li>
                                <p>Google Cloud - the name of the source organization, folder, or project depending on the workspaceType (for example, cybrsca-dev)</p>
                            </li>
                            <li>
                                <p>Azure RBAC (resource based) - the scope where the role is applied, provided as a path (for example, the path for a management group scope may be <span class="Wrap">providers/Microsoft.Management/managementGroups/&lt;roleDefinition&gt;</span>, while the path for a subscription scope or lower may be /subscriptions/&lt;<span class="Italics">roleDefinition</span><span class="Wrap">&gt;/resourceGroups/cloud-shell-storage-westeurope/providers/Microsoft.Storage/storageAccounts/csb10032002529a3d5e)</span></p>
                            </li>
                            <li>
                                <p><MadCap:variable name="cv-shared-variables.entra-id-long" /> - <MadCap:variable name="cv-shared-variables.entra-id-short" /> tenant ID</p>
                            </li>
                        </ul>
                    </td>
                </tr>
                <tr class="TableStyle-Standard-Body-Body1">
                    <td class="TableStyle-Standard-BodyD-Column1-Body1">
                        <p><span class="Emphasis">organization_id</span> </p>
                        <ul>
                            <li>
                                <p>AWS - management account ID</p>
                            </li>
                            <li>
                                <p>Google Cloud - organization ID</p>
                            </li>
                            <li>
                                <p>Azure - directory ID</p>
                            </li>
                        </ul>
                    </td>
                </tr>
                <tr class="TableStyle-Standard-Body-Body1">
                    <td class="TableStyle-Standard-BodyE-Column1-Body1">
                        <p>&#160;</p>
                    </td>
                    <td class="TableStyle-Standard-BodyD-Column1-Body1">
                        <p><span class="Emphasis">workspace_type</span>
                        </p>
                        <ul>
                            <li>
                                <p>
AWS - supported value is <span class="Emphasis">account</span></p>
                            </li>
                            <li>
                                <p>Google Cloud - supported values are <span class="Emphasis">gcp_organization</span>, <span class="Emphasis">folder</span>, and <span class="Emphasis">project</span></p>
                            </li>
                            <li>
                                <p>
Azure - supported values are <span class="Emphasis">directory</span>, <span class="Emphasis">management_group</span>, <span class="Emphasis">subscription</span>, <span class="Emphasis">resource_group</span>, and <span class="Emphasis">resource</span></p>
                            </li>
                        </ul>
                    </td>
                </tr>
                <tr class="TableStyle-Standard-Body-Body1">
                    <td class="TableStyle-Standard-BodyE-Column1-Body1">
                        <p><span class="Emphasis">identities</span>
                        </p>
                    </td>
                    <td class="TableStyle-Standard-BodyD-Column1-Body1">
                        <p>Identities (users) to which the policy applies, defined by the following:</p>
                        <ul>
                            <li>
                                <p><span class="Emphasis">entity_name</span> - fully qualified name of the <MadCap:variable name="cc_product_vars.Identity-full" /> role</p>
                            </li>
                            <li>
                                <p><span class="Emphasis">entity_source_id</span> - unique ID of the source of the user/role in <MadCap:variable name="cc_product_vars.Identity-full" /></p>
                            </li>
                            <li>
                                <p><span class="Emphasis">entity_class</span> - supported values are <span class="Emphasis">user</span>, <span class="Emphasis">group</span>, and <span class="Emphasis">role</span></p>
                            </li>
                        </ul>
                    </td>
                </tr>
                <tr class="TableStyle-Standard-Body-Body1">
                    <td class="TableStyle-Standard-BodyE-Column1-Body1">
                        <p><span class="Emphasis">start_date</span>
                        </p>
                    </td>
                    <td class="TableStyle-Standard-BodyD-Column1-Body1">
                        <p>(Optional) The date and time when the policy becomes active, in ISO format.</p>
                    </td>
                </tr>
                <tr class="TableStyle-Standard-Body-Body1">
                    <td class="TableStyle-Standard-BodyE-Column1-Body1">
                        <p><span class="Emphasis">end_date</span>
                        </p>
                    </td>
                    <td class="TableStyle-Standard-BodyD-Column1-Body1">
                        <p>(Optional) The date and time when the policy expires, in ISO format.</p>
                    </td>
                </tr>
                <tr class="TableStyle-Standard-Body-Body1">
                    <td class="TableStyle-Standard-BodyB-Column1-Body1">
                        <p><span class="Emphasis">access_rules</span>
                        </p>
                    </td>
                    <td class="TableStyle-Standard-BodyA-Column1-Body1">
                        <p>A set of rules that specify when the policy is active.</p>
                        <ul>
                            <li>
                                <p><span class="Emphasis">days</span>
                                </p>
                                <p>Days of the week. </p>
                                <p>Supported values: <span class="Emphasis">sunday</span>, <span class="Emphasis">monday</span>, <span class="Emphasis">tuesday</span>, <span class="Emphasis">wednesday</span>, <span class="Emphasis">thursday</span>, <span class="Emphasis">friday</span>, and <span class="Emphasis">saturday</span></p>
                            </li>
                            <li>
                                <p><span class="Emphasis">from_time</span>
                                </p>
                                <p>(Optional) Time of day when the policy becomes active, in 24-hour format. For example, to activate the policy at 8AM, use the value <span class="Emphasis">08:00</span>.</p>
                            </li>
                            <li>
                                <p><span class="Emphasis">to_time</span>
                                </p>
                                <p>(Optional) Time of day when the policy is deactivated, in 24-hour format. For example, to deactivate the policy at 5PM, use the value <span class="Emphasis">17:00</span>.</p>
                            </li>
                            <li>
                                <p><span class="Emphasis">max_session_duration</span>
                                </p>
                                <p>Maximum allowed length, in hours, of the user session. For example, to set a duration of two hours, use the value <span class="Emphasis">2</span>.</p>
                            </li>
                            <li>
                                <p><span class="Emphasis">time_zone</span>
                                </p>
                                <p>A time-zone qualified string representing the time zone of the client host machine. For example, <span class="Emphasis">America/Los_Angeles</span>.</p>
                            </li>
                        </ul>
                    </td>
                </tr>
            </tbody>
        </table>
        <h4>Example</h4>
        <p>See this example of the sca_policy section in the main.tf file.</p>
        <div class="example"><pre><code>
resource "sca_policy" "policy_example" {
  csp  = "AWS"
  roles = [
    {
      entity_id        = "arn:aws:iam::xxxxxxxxxxxx:role/devOps"
      entity_source_id = "xxxxxxxxxxxx"
      workspace_type   = "account"
    }
  ]
  identities = [
    {
      entity_name      = "user@cyberark.cloud.xxx"
      entity_source_id = "id"
      entity_class     = "user"
    }
  ]
  access_rules = {
    days = [
      "sunday",
      "monday",
      "tuesday",
      "wednesday",
      "thursday",
      "friday",
      "saturday"
    ]
    from_time            = "09:00"
    to_time              = "17:00"
    max_session_duration = 1
    time_zone            = "Asia/Jerusalem"
  }  
  start_date = "2022-07-12T00:00:00.000Z"
  end_date   = "2022-10-10T00:00:00.000Z"
}

</code></pre>
        </div>
        <h3>sca_queryPolicies</h3>
        <p>The variables in the <code>sca_queryPolicies data</code> section are used to query the status of a policy during automation operations. If you don't want to automate this activity, you can delete the section in the variables.tf file.</p>
        <table style="mc-table-style: url('../Resources/TableStyles/Standard.css');margin-left: 0;margin-right: auto;caption-side: top;width: 100%;" class="TableStyle-Standard" cellspacing="0" summary="The sca_queryPolicies variables that need values if you need to know the status of a policy">
            <caption>sca_queryPolicies variables</caption>
            <col class="TableStyle-Standard-Column-Column1">
            </col>
            <col class="TableStyle-Standard-Column-Column1">
            </col>
            <thead>
                <tr class="TableStyle-Standard-Head-Header1">
                    <th class="TableStyle-Standard-HeadE-Column1-Header1">
                        <p>Variable</p>
                    </th>
                    <th class="TableStyle-Standard-HeadD-Column1-Header1">
                        <p>Description</p>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr class="TableStyle-Standard-Body-Body1">
                    <td class="TableStyle-Standard-BodyE-Column1-Body1">
                        <p><span class="Emphasis">csp</span>
                        </p>
                    </td>
                    <td class="TableStyle-Standard-BodyD-Column1-Body1">
                        <p>Cloud service provider</p>
                        <p>Supported values:</p>
                        <ul>
                            <li>
                                <p><span class="Emphasis">AWS</span>
                                </p>
                            </li>
                            <li>
                                <p><span class="Emphasis">GCP</span>
                                </p>
                            </li>
                            <li>
                                <p><span class="Emphasis">AZURE</span>
                                </p>
                            </li>
                        </ul>
                        <div class="note" MadCap:conditions="cc_C_CyberArk.NOT_TO_PUBLISH">
                            <p>This information is needed when <MadCap:variable name="cc_product_vars.SCA-short" /> policies will be filtered based on the cloud provider.</p>
                        </div>
                    </td>
                </tr>
                <tr class="TableStyle-Standard-Body-Body1">
                    <td class="TableStyle-Standard-BodyE-Column1-Body1">
                        <p><span class="Emphasis">status</span>
                        </p>
                    </td>
                    <td class="TableStyle-Standard-BodyD-Column1-Body1">
                        <p>Filter policies according to status</p>
                        <p>Supported values:</p>
                        <ul>
                            <li>
                                <p>Active</p>
                            </li>
                            <li>
                                <p>Expired</p>
                            </li>
                            <li>
                                <p>Error</p>
                            </li>
                            <li>
                                <p>Warning</p>
                            </li>
                            <li>
                                <p>Validating</p>
                            </li>
                        </ul>
                    </td>
                </tr>
                <tr class="TableStyle-Standard-Body-Body1">
                    <td class="TableStyle-Standard-BodyE-Column1-Body1">
                        <p><span class="Emphasis">free_text</span>
                        </p>
                    </td>
                    <td class="TableStyle-Standard-BodyD-Column1-Body1">
                        <p>Search using free text. The following parameters are supported:</p>
                        <ul>
                            <li>
                                <p>Name</p>
                            </li>
                            <li>
                                <p>Description</p>
                            </li>
                            <li>
                                <p> Identity name</p>
                            </li>
                            <li>
                                <p>Organization ID</p>
                            </li>
                            <li>
                                <p> Cloud provider</p>
                            </li>
                            <li>
                                <p>Status</p>
                            </li>
                            <li>
                                <p>Account name</p>
                            </li>
                        </ul>
                    </td>
                </tr>
                <tr class="TableStyle-Standard-Body-Body1">
                    <td class="TableStyle-Standard-BodyB-Column1-Body1">
                        <p><span class="Emphasis">page_size</span>
                        </p>
                    </td>
                    <td class="TableStyle-Standard-BodyA-Column1-Body1">
                        <p>Define the number of results that should appear per page (maximum = 100)</p>
                    </td>
                </tr>
            </tbody>
        </table>
        <h4>Example</h4>
        <div class="example">
            <!--<p>See this example of the sca_queryPolicies section in the main.tf file.</p>--><pre><code>data "sca_queryPolicies" "queryPolicies_example" {
  free_text = "PolicyForITTeam"
  csp       = "AWS"
  status    = "Active"
  page_size = 50
}</code></pre>
        </div>
        <h2 class="step" MadCap:autonum="Step 3: ">Run Terraform for <MadCap:variable name="cc_product_vars.SCA-short" /></h2>
        <p>Run the following commands from the main.tf file:</p>
        <div class="code"><pre><code>terraform init</code></pre>
        </div>
        <div class="code"><pre><code>terraform apply</code></pre>
        </div>
        <p>To run Terraform in<span class="Emphasis"> debug</span> mode, use the following command:</p>
        <div class="code"><pre><code>TF_LOG=DEBUG terrafrom apply</code></pre>
        </div>
    </body>
</html>