{
  "openapi": "3.0.0",
  "info": {
    "title": "SCA General Cloud Activity API",
    "version": "1.0.0",
    "description": "This API enables you to perform SCA cloud-related operations.<br><br>For example, you can programmatically start a scan operation",
    "contact": {
      "name": "SCA Group"
    }
  },
  "servers": [
    {
      "url": "https://{tenant_name}.sca.cyberark.cloud/api",
      "description": "SCA Base URL"
    }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer"
      }
    },
    "schemas": {
      "ScanRequest": {
        "type": "object",
        "properties": {
          "cloudProvider": {
            "type": "integer",
            "description": "The cloud environment that the scan applies to. Supported values: AWS = 0, Google Cloud = 1, Azure = 2"
          },
          "accountType": {
            "type": "string",
            "description": "Type of the scan. 'All' for all accounts, 'Specific' for specific accounts"
          },
          "entityIds": {
            "type": "array",
            "items": {
              "$ref": "#/components/parameters/entityIds"
            },
            "description": "List of IDs of what should be scanned when accountType is 'Specific'\n\nAWS standalone account: The AWS account ID (for example, [{\"account_id\": \"123456789012\"}])\n\nAWS account in an organization: The organization ID (management account ID) and account ID of the account in that organization (for example, [{\"org_id\": \"098765432109\", \"account_id\": \"123456789012\"}])\n\nGoogle Cloud project: The GCP organization ID and project ID of the Google Cloud project in that organization (for example, [{\"org_id\": \"123457654321\", \"account_id\": \"xyz-gcp-project\" }])\n\nAzure Resource subscription: The organization ID should be the Azure tenant ID, and the account ID should be the subscription ID of the specific subscription (for example, [{\"org_id\": \"abcde123-abcd-123a-abcd-a1b23456cd7e\", \"account_id\": \"aaaa1111-1111-111a-aaaa-aaaa1111aa1a\"}])\n\nAzure - Microsoft Entra ID: Both organization ID and account ID should use the Azure tenant ID (for example, [{\"org_id\": \"abcde123-abcd-123a-abcd-a1b23456cd7e\", \"account_id\": \"abcde123-abcd-123a-abcd-a1b23456cd7e\"}])"
          }
        }
      },
      "ScanResult": {
        "type": "object",
        "properties": {
          "jobId": {
            "type": "string",
            "description": "The unique ID of the scan process"
          },
          "operation": {
            "type": "string",
            "description": "Type of scan operation"
          },
          "alreadyRunning": {
            "type": "boolean",
            "description": "Indicates whether the scan is already in progress"
          }
        },
        "example": {
          "jobId": "e51a10e2-3666-4496-a459-233a917ea2c7",
          "operation": "Rescan",
          "alreadyRunning": false
        }
      }
    },
    "responses": {
      "ScanResponse": {
        "description": "Response for scanning operation",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ScanResult"
            }
          }
        }
      }
    },
    "parameters": {
      "cloudProvider": {
        "name": "cloudProvider",
        "in": "query",
        "required": false,
        "schema": {
          "type": "integer",
          "enum": [
            0,
            1,
            2,
            3,
            4
          ],
          "description": "Filter by the cloud provider that the policy applies to. Supported values: AWS IAM = 0, Google Cloud = 1, Azure RBAC = 2, AWS IAM Identity Center = 3, Azure - Microsoft Entra ID = 4"
        }
      },
      "entityIds": {
        "name": "entityIds",
        "in": "query",
        "required": false,
        "schema": {
          "type": "object",
          "properties": {
            "org_id": {
              "type": "string"
            },
            "account_id": {
              "type": "string"
            }
          },
          "description": "Cloud entity ID"
        }
      }
    },
    "requestBodies": {
      "ScanRequestBody": {
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/ScanRequest"
            },
            "examples": {
              "example1": {
                "summary": "Scan all AWS accounts (standalone and in organizations)",
                "value": {
                  "cloudProvider": 0,
                  "accountType": "All"
                }
              },
              "example10": {
                "summary": "Scan all Google Cloud projects",
                "value": {
                  "cloudProvider": 1,
                  "accountType": "All"
                }
              },
              "example11": {
                "summary": "Scan all Microsoft Entra ID directories",
                "value": {
                  "cloudProvider": 2,
                  "accountType": "All"
                }
              },
              "example2": {
                "summary": "Scan a specific standalone AWS account",
                "value": {
                  "cloudProvider": 0,
                  "accountType": "Specific",
                  "entityIds": [
                    {
                      "account_id": "<Account ID>"
                    }
                  ]
                }
              },
              "example3": {
                "summary": "Scan a specific AWS account in an organization",
                "value": {
                  "cloudProvider": 0,
                  "accountType": "Specific",
                  "entityIds": [
                    {
                      "org_id": "<Management account ID>",
                      "account_id": "<Account ID>"
                    }
                  ]
                }
              },
              "example4": {
                "summary": "Scan a specific Google Cloud project",
                "value": {
                  "cloudProvider": 1,
                  "accountType": "Specific",
                  "entityIds": [
                    {
                      "org_id": "<Organization ID>",
                      "account_id": "<Project ID>"
                    }
                  ]
                }
              },
              "example5": {
                "summary": "Scan a specific Azure subscription",
                "value": {
                  "cloudProvider": 2,
                  "accountType": "Specific",
                  "entityIds": [
                    {
                      "org_id": "<Azure tenant ID>",
                      "account_id": "<Subscription ID>"
                    }
                  ]
                }
              },
              "example50": {
                "summary": "Scan a specific Microsoft Entra ID directory",
                "value": {
                  "cloudProvider": 2,
                  "accountType": "Specific",
                  "entityIds": [
                    {
                      "org_id": "<Azure tenant ID>",
                      "account_id": "<Azure tenant ID>"
                    }
                  ]
                }
              }
            }
          }
        }
      }
    }
  },
  "paths": {
    "/cloud/rescan": {
      "post": {
        "tags": [
          "Cloud"
        ],
        "summary": "Initiate Scan",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "schema": {
              "type": "boolean"
            },
            "name": "debug",
            "in": "query",
            "required": false,
            "description": "(Optional) Enable debug mode for additional troubleshooting information. \n\n**Default** :  false"
          }
        ],
        "responses": {
          "200": {
            "$ref": "#/components/responses/ScanResponse"
          },
          "500": {
            "description": "Internal Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "faultCode": {
                      "type": "string"
                    },
                    "headerMessage": {
                      "type": "string"
                    },
                    "bodyMessage": {
                      "type": "string"
                    },
                    "correlationId": {
                      "type": "string"
                    },
                    "uiType": {
                      "type": "integer"
                    },
                    "innerError": {
                      "type": "string"
                    },
                    "debug_info": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "name": {
                            "type": "string"
                          },
                          "status": {
                            "type": "string"
                          },
                          "error_code": {
                            "type": "string"
                          },
                          "reason": {
                            "type": "string"
                          }
                        }
                      }
                    }
                  }
                },
                "examples": {
                  "example1": {
                    "summary": "Error response when debug param is true",
                    "value": {
                      "faultCode": "CC1021",
                      "headerMessage": "Scan error",
                      "bodyMessage": "Scan operation failed. Try to run the scan again. If that doesn't work, contact CyberArk support.",
                      "correlationId": "612b32bf-e5f7-4f14-9a0f-0d4a66f156af",
                      "uiType": 3,
                      "debug_info": [
                        {
                          "name": "RESCAN_STARTED",
                          "status": "Failure",
                          "error_code": "CC1021",
                          "reason": "While running the scan, an internal error occurred when trying to create new index"
                        }
                      ]
                    }
                  },
                  "example2": {
                    "summary": "Error response when debug param is false",
                    "value": {
                      "faultCode": "CC1021",
                      "headerMessage": "Scan error",
                      "bodyMessage": "Scan operation failed. Try to run the scan again. If that doesn't work, contact CyberArk support.",
                      "correlationId": "612b32bf-e5f7-4f14-9a0f-0d4a66f156af",
                      "uiType": 3
                    }
                  }
                }
              }
            }
          }
        },
        "operationId": "InitiateScan",
        "requestBody": {
          "$ref": "#/components/requestBodies/ScanRequestBody"
        },
        "description": "Start a scan on the cloud resources. This operation is asynchronous, and returns a job identifier. The /integration/status API can be used to pull the job status"
      }
    }
  }
}