<?xml version="1.0" encoding="utf-8"?>
<html>
    <head>
        <link href="../Resources/TableStyles/Standard.css" rel="stylesheet" MadCap:stylesheetType="table" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" />
    </head>
    <body>
        <h1>Behind the scenes for AWS</h1>
        <MadCap:snippetBlock src="../Resources/Snippets/SharedBetweenProjects.flsnp" MadCap:conditions="cc_C_CyberArk.NOT_TO_PUBLISH" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" />
        <p>This topic describes the root discovery process and roles and permissions used by <MadCap:variable name="cc_product_vars.CV-full" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" /> to connect. </p>
        <p>When you connect an AWS organization to <MadCap:variable name="cc_product_vars.CV-full" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" />, <MadCap:variable name="project_variables.CompanyName" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" /> provides a CloudFormation template to create the necessary resources. </p>
        <p>Each of the following sections describes the details behind each operation in the CloudFormation template.</p>
        <h2>Discover a new organization</h2>
        <p>This section describes how <MadCap:variable name="cc_product_vars.CV-full" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" /> discovers a new organization.</p>
        <p>To enable you to connect to any point in the root hierarchy, <MadCap:variable name="cc_product_vars.CV-full" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" /> discovers the entire resource hierarchy in the region you specified. </p>
        <h3 class="step" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:autonum="Step 1: ">Create a role</h3>
        <p>The CloudFormation template creates an AWS role  to discover the resource hierarchy. The name of the role is <code>CyberArkOrgRoleForCEM.</code> </p>
        <h3 class="step" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:autonum="Step 2: ">Grant access</h3>
        <p>The <code>CyberArkOrgRoleForCEM </code>role includes a manage policy named <code>AWSOrganizationsReadOnlyAccess</code> to grant read only access to the AWS organization's service.</p>
        <h3 class="step" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:autonum="Step 3: ">Discover the organization</h3>
        <p>Finally, <MadCap:variable name="cc_product_vars.CV-full" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" /> uses the following AWS APIs to discover the hierarchy resources:</p>
        <ul>
            <li>
                <p>list_accounts_for_parent</p>
            </li>
            <li>
                <p>list_organizational_units_for_parent</p>
            </li>
            <li>
                <p>describe_organization</p>
            </li>
            <li>
                <p>list_roots</p>
            </li>
        </ul>
        <h2><a name="Enable"></a>Enable the scan </h2>
        <p>This section describes how the scan is enabled.</p>
        <h3 class="stepReset" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:autonum="Step 1: ">Create permissions</h3><![CDATA[
]]><MadCap:conditionalText MadCap:conditions="cc_C_CyberArk.NOT_TO_PUBLISH" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">   DPACloud/Connect-AWS-Account
		</MadCap:conditionalText><![CDATA[        ]]><p>To enable <MadCap:variable name="cc_product_vars.CV-full" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" /> to scan your organization, the CloudFormation template creates a role with the following prefix: <code>CyberArkOrgMemberRoleForCEM</code>. </p><p>The method to create the role depends on the account type:</p><table style="width: 100%;mc-table-style: url('../Resources/TableStyles/Standard.css');" class="TableStyle-Standard" cellspacing="0"><caption>Role creation method</caption><col class="TableStyle-Standard-Column-Column1" /><col class="TableStyle-Standard-Column-Column1" /><thead><tr class="TableStyle-Standard-Head-Header1"><th class="TableStyle-Standard-HeadE-Column1-Header1">Role</th><th class="TableStyle-Standard-HeadD-Column1-Header1"><p>Method</p></th></tr></thead><tbody><tr class="TableStyle-Standard-Body-Body1"><td class="TableStyle-Standard-BodyE-Column1-Body1"><p>Member accounts</p></td><td class="TableStyle-Standard-BodyD-Column1-Body1"><p>This role is created using a StackSet that deploys instances for each member account in your organization.</p></td></tr><tr class="TableStyle-Standard-Body-Body1"><td class="TableStyle-Standard-BodyB-Column1-Body1"><p>Management accounts</p></td><td class="TableStyle-Standard-BodyA-Column1-Body1"><p>This  role is created in the main stack.</p></td></tr></tbody></table><p> Attached to this role is the <code>CyberArkOrgPolicyForCEM</code> policy that grants <MadCap:variable name="cc_product_vars.CV-full" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" /> permissions to scan. </p><p>These permissions include the following:</p><table style="width: 100%;mc-table-style: url('../Resources/TableStyles/Standard.css');" class="TableStyle-Standard" cellspacing="0"><caption>Included permissions</caption><col class="TableStyle-Standard-Column-Column1" /><col class="TableStyle-Standard-Column-Column1" /><col class="TableStyle-Standard-Column-Column1" /><thead><tr class="TableStyle-Standard-Head-Header1"><th class="TableStyle-Standard-HeadE-Column1-Header1">Permission</th><th class="TableStyle-Standard-HeadE-Column1-Header1"><p>Description</p></th><th class="TableStyle-Standard-HeadD-Column1-Header1">Type</th></tr></thead><tbody><tr class="TableStyle-Standard-Body-Body1"><td class="TableStyle-Standard-BodyE-Column1-Body1"><p>GetLoginProfile</p></td><td class="TableStyle-Standard-BodyE-Column1-Body1"><p>Retrieves the user name and password-creation date for the specified IAM user</p></td><td class="TableStyle-Standard-BodyD-Column1-Body1">&#160;</td></tr><tr class="TableStyle-Standard-Body-Body1"><td class="TableStyle-Standard-BodyE-Column1-Body1"><p>ListMFADevices</p></td><td class="TableStyle-Standard-BodyE-Column1-Body1"><p>Lists the MFA devices for an IAM user</p></td><td class="TableStyle-Standard-BodyD-Column1-Body1">&#160;</td></tr><tr class="TableStyle-Standard-Body-Body1"><td class="TableStyle-Standard-BodyB-Column1-Body1"><p>GetAccountAuthorizationDetails</p></td><td class="TableStyle-Standard-BodyB-Column1-Body1"><p>Generates a report that includes details about when an IAM resource (user, group, role, or policy) was last used in an attempt to access AWS service</p></td><td class="TableStyle-Standard-BodyA-Column1-Body1">&#160;</td></tr></tbody></table><h3 class="step" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:autonum="Step 2: ">Scan selected accounts</h3><p>AWS provides an API whose name matches the name of the permissions list above, to enable <MadCap:variable name="cc_product_vars.CV-full" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" /> to scan the your selected accounts. </p><h2>Manage the CloudFormation process</h2><p>This section describes the permission required to manage the CloudFormation process.</p><p>To determine if the stack was successfully installed on the member accounts, <MadCap:variable name="cc_product_vars.CV-full" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" /> needs the following permission to be granted to the <code>CyberArkOrgRoleForCEM</code> role described in the <MadCap:xref href="#Enable" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">Enable the scan </MadCap:xref>section.</p><p>The following permissions are granted to the role, specifically for the <MadCap:variable name="cc_product_vars.CV-full" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" /> stack, to manage the process.</p><table style="width: 100%;mc-table-style: url('../Resources/TableStyles/Standard.css');" class="TableStyle-Standard" cellspacing="0"><caption>Permissions granted</caption><col class="TableStyle-Standard-Column-Column1" /><col class="TableStyle-Standard-Column-Column1" /><col class="TableStyle-Standard-Column-Column1" /><thead><tr class="TableStyle-Standard-Head-Header1"><th class="TableStyle-Standard-HeadE-Column1-Header1">Permission</th><th class="TableStyle-Standard-HeadE-Column1-Header1"><p>Description</p></th><th class="TableStyle-Standard-HeadD-Column1-Header1">Type</th></tr></thead><tbody><tr class="TableStyle-Standard-Body-Body1"><td class="TableStyle-Standard-BodyE-Column1-Body1"><p>ListStackInstances</p></td><td class="TableStyle-Standard-BodyE-Column1-Body1"><p>Returns summary information about stack instances that are associated with the specified StackSet</p></td><td class="TableStyle-Standard-BodyD-Column1-Body1">CloudFormation</td></tr><tr class="TableStyle-Standard-Body-Body1"><td class="TableStyle-Standard-BodyE-Column1-Body1"><p>DetectStackSetDrift</p></td><td class="TableStyle-Standard-BodyE-Column1-Body1"><p>Detects drift on a StackSet</p></td><td class="TableStyle-Standard-BodyD-Column1-Body1"><p>CloudFormation</p></td></tr><tr class="TableStyle-Standard-Body-Body1"><td class="TableStyle-Standard-BodyE-Column1-Body1"><p>DescribeStackSet</p></td><td class="TableStyle-Standard-BodyE-Column1-Body1"><p>Returns the description of the specified StackSet</p></td><td class="TableStyle-Standard-BodyD-Column1-Body1"><p>CloudFormation</p></td></tr><tr class="TableStyle-Standard-Body-Body1"><td class="TableStyle-Standard-BodyB-Column1-Body1"><p>DescribeStackInstance</p></td><td class="TableStyle-Standard-BodyB-Column1-Body1"><p>Returns the stack instance that's associated with the specified StackSet</p></td><td class="TableStyle-Standard-BodyA-Column1-Body1"><p>CloudFormation</p></td></tr></tbody></table></body>
</html>