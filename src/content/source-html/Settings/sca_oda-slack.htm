<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head>
        <link href="../Resources/TableStyles/Standard.css" rel="stylesheet" MadCap:stylesheetType="table" />
    </head>
    <body>
        <h1>Configure approval channel - Slack</h1>
        <p>This topic describes how to configure Slack as your <MadCap:variable name="cc_product_vars.SCA-short" /> approval channel.</p>
        <h2>Before you begin</h2>
        <p>Before you set up the integration between <MadCap:variable name="cc_product_vars.SCA-short" /> and Slack, complete the steps described in <MadCap:xref href="sca_on-demand-access-settings.htm">Set up on-demand access</MadCap:xref>, the last of which brings you back to this topic to complete the approval channel configuration.</p>
        <p>To support communication with Slack, <MadCap:variable name="cc_product_vars.Flows-short" /> must be enabled in your <MadCap:variable name="cc_C_CyberArk.CompanyName" /> tenant. A <span class="Emphasis">Flows Executor</span> role is sufficient for granting on-demand access. </p>
        <h2 class="stepReset" MadCap:autonum="Step 1: "><a name="Set"></a><a name="slack-setup"></a>Set up Slack</h2>
        <p>In this step, you set up Slack to be able to work with <MadCap:variable name="cc_product_vars.SCA-short" />.</p>
        <h3 class="step" MadCap:autonum="Step 1: ">Create the Slack app </h3>
        <p>You have to create a new app in Slack to enable communication between <MadCap:variable name="cc_C_CyberArk.CompanyName" /> and Slack. </p>
        <ol>
            <li>
                <p>Go to <a href="https://api.slack.com/">api.slack.com</a> and in the Your Apps page, click <span class="Emphasis">Create New App</span>.</p>
            </li>
            <li>
                <p>In the Create an app window, select <span class="Emphasis">From scratch</span>, provide the <span class="Emphasis">App Name</span>, and select the <span class="Emphasis">CyberArk SCA </span>workspace. Click <span class="Emphasis">Create App</span>.</p>
            </li>
        </ol>
        <h3 class="step" MadCap:autonum="Step 2: ">Apply the redirect URL</h3>
        <ol>
            <li>
                <p>In the Basic Information page, scroll down and click <span class="Emphasis">OAuth &amp; Permissions</span>.</p>
            </li>
            <li>
                <p>Scroll down to the <span class="Emphasis">Redirect URLs </span>area, and click <span class="Emphasis">Add New Redirect URL</span>.</p>
            </li>
            <li>
                <p>Open <MadCap:variable name="cc_product_vars.Flows-short" /> and copy the application URL&#160;into the <span class="Emphasis">Redirect URLs </span>field using the format <span class="Emphasis">https://&lt;identity flows url&gt;/gateway/callback</span>. Click <span class="Emphasis">Add</span>, then click <span class="Emphasis">Save URLs</span>. </p>
            </li>
        </ol>
        <h3 class="step" MadCap:autonum="Step 3: ">Set the permission scope</h3>
        <ol>
            <li>
                <p>In the navigation pane, under <span class="Emphasis">Settings</span> select <span class="Emphasis">Basic Information</span>.</p>
            </li>
            <li>
                <p>In the <span class="Emphasis">Building Apps for Slack </span>area, click to expand the <span class="Emphasis">Add features and functionality </span>section. Scroll down and expand the <span class="Emphasis">Install your app </span>area, and click <span class="Emphasis">permission scope </span>in the note.</p>
            </li>
            <li>
                <p>In the OAuth &amp; Permissions page, scroll down to the <span class="Emphasis">Scopes </span>area and in the <span class="Emphasis">Bot Token Scopes</span> section, click <span class="Emphasis">Add an OAuth Scope</span>, then select <span class="Emphasis">chat:write </span>from the list.</p>
            </li>
        </ol>
        <h3 class="step" MadCap:autonum="Step 4: ">Finish setting up the app</h3>
        <ol>
            <li>
                <p>Go back to the <span class="Emphasis">Settings </span>&gt; <span class="Emphasis">Basic Information </span>page, and in the <span class="Emphasis">Install your app </span>area, click <span class="Emphasis">Install to Workspace</span>.</p>
            </li>
            <li>
                <p>In the confirmation page, click <span class="Emphasis">Allow</span>.</p>
            </li>
        </ol>
        <div class="note">
            <p>You'll need the Slack app credentials when you configure the <span class="Emphasis">SCA ondemand Slack</span> flow in <MadCap:variable name="cc_product_vars.Flows-short" />. This information is available at the bottom of the Basic Information page.</p>
        </div>
        <h3 class="step" MadCap:autonum="Step 5: "><a name="Create"></a>Create a Slack channel</h3>
        <p>You need a dedicated Slack channel that will receive and send messages via <MadCap:variable name="cc_product_vars.Flows-short" />. Set one up as described in the <a href="https://slack.com/intl/en-au/help/articles/201402297-Create-a-channel#:~:text=From your sidebar%2C click on,click on Skip for now." alt="link to instructions for setting up a channel in Slack">Slack docs</a>, and save the channel ID to apply when you configure the <span class="Emphasis">SCA ondemand Slack</span> flow in <MadCap:variable name="cc_product_vars.Flows-short" />. Note the channel ID—you will need it later on in this procedure.</p>
        <div>
            <h2 class="step" MadCap:autonum="Step 2: "><a name="Download"></a><a name="slack-flows"></a>Download the <MadCap:variable name="cc_product_vars.SCA-short" /> pre-defined flows</h2>
            <p>From the <MadCap:variable name="cc_product_vars.SCA-short" /> on demand settings page, download the <span class="Emphasis">Flows</span> zip file and unzip it in a local directory. This zip file contains the following pre-defined flows in JSON format, which you have to import into <MadCap:variable name="cc_product_vars.Flows-short" /> and configure with your channel and <MadCap:variable name="cc_product_vars.SCA-short" /> information:</p>
            <ul>
                <li>
                    <p><span class="Emphasis">SCA Ondemand </span>- configure with your Slack app credentials to enable communication between <MadCap:variable name="cc_C_CyberArk.CompanyName" /> and Slack.</p>
                </li>
                <li>
                    <p><span class="Emphasis">SCA Ondemand Slack</span> - configure your OAuth2 server information to enable triggering <MadCap:variable name="cc_product_vars.SCA-short" /> to create an ad-hoc policy when the access request is approved.</p>
                </li>
            </ul>
            <div class="important">
                <p>Don't change the names of the JSON files when you unzip them. If you change a file name, this will break the flow and the feature won't work as expected.</p>
            </div>
            <div class="note">
                <p><MadCap:variable name="cc_product_vars.SCA-short" /> uses the following APIs as part of on-demand access flows:</p>
                <ul>
                    <li>
                        <p><span class="Emphasis">Notification API</span> - sends request and approval messages by email during on-demand access flows.</p>
                    </li>
                    <li>
                        <p><span class="Emphasis">SCA Policy API - Create Policy V2</span> - creates policies in <MadCap:variable name="cc_product_vars.SCA-short" /> as needed.</p>
                    </li>
                    <li>
                        <p><span class="Emphasis">SCA Infrastructure API - Get Job Status</span> - gets the status of a job created by an asynchronous API call.</p>
                    </li>
                </ul>
            </div>
            <h2 class="step" MadCap:autonum="Step 3: "><a name="Import"></a>Import and configure the flows in <MadCap:variable name="cc_product_vars.Flows-short" /></h2>
            <h3 class="stepReset" MadCap:autonum="Step 1: ">Import the flow and configure trust</h3>
            <p>In <MadCap:variable name="cc_product_vars.Flows-short" />, configure the authentication and authorization details for communication between <MadCap:variable name="cc_C_CyberArk.CompanyName" /> and the approval channel.</p>
            <ol>
                <li>
                    <p>Click <span class="Emphasis">Import </span>and upload the <span class="Emphasis">SCA Ondemand </span>JSON file.</p>
                </li>
                <li>
                    <p>Click <span class="Emphasis">Save</span>.</p>
                </li>
                <li>
                    <p>Click the <span class="Emphasis">Chat Post Message </span>component in the flow.</p>
                </li>
                <li>
                    <p>In <span class="Emphasis">Settings </span>&gt; <span class="Emphasis">Authorizations</span>, click <span class="Emphasis">ADD NEW</span>.</p>
                </li>
                <li>
                    <p>In the <span class="Emphasis">Manage Authorizations </span>window, configure the following to create an authorization for Slack:</p>
                    <ol style="list-style-type: lower-alpha;">
                        <li>
                            <p>Fill in the following fields:</p>
                            <table style="mc-table-style: url('../Resources/TableStyles/Standard.css');caption-side: top;" class="TableStyle-Standard" cellspacing="0" summary="Lists the Slack information that has to be applied to the authorization">
                                <caption>Slack authorization details</caption>
                                <col class="TableStyle-Standard-Column-Column1" />
                                <col class="TableStyle-Standard-Column-Column1" />
                                <thead>
                                    <tr class="TableStyle-Standard-Head-Header1">
                                        <th class="TableStyle-Standard-HeadE-Column1-Header1">
                                            <p>Item</p>
                                        </th>
                                        <th class="TableStyle-Standard-HeadD-Column1-Header1">
                                            <p>Description</p>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="TableStyle-Standard-Body-Body1">
                                        <td class="TableStyle-Standard-BodyE-Column1-Body1">
                                            <p><span class="Emphasis">Name</span>
                                            </p>
                                        </td>
                                        <td class="TableStyle-Standard-BodyD-Column1-Body1">
                                            <p>Provide a name for the server</p>
                                        </td>
                                    </tr>
                                    <tr class="TableStyle-Standard-Body-Body1">
                                        <td class="TableStyle-Standard-BodyE-Column1-Body1">
                                            <p><span class="Emphasis">Type</span>
                                            </p>
                                        </td>
                                        <td class="TableStyle-Standard-BodyD-Column1-Body1">
                                            <p>Select <span class="Emphasis">OAuth2</span></p>
                                        </td>
                                    </tr>
                                    <tr class="TableStyle-Standard-Body-Body1">
                                        <td class="TableStyle-Standard-BodyE-Column1-Body1">
                                            <p><span class="Emphasis">Flow</span>
                                            </p>
                                        </td>
                                        <td class="TableStyle-Standard-BodyD-Column1-Body1">
                                            <p>Select <span class="Emphasis">Authorization Code</span></p>
                                        </td>
                                    </tr>
                                    <tr class="TableStyle-Standard-Body-Body1">
                                        <td class="TableStyle-Standard-BodyE-Column1-Body1">
                                            <p><span class="Emphasis">Content Type</span>
                                            </p>
                                        </td>
                                        <td class="TableStyle-Standard-BodyD-Column1-Body1">
                                            <p>Select <span class="Emphasis">application/x-www-form-urlencoded</span></p>
                                        </td>
                                    </tr>
                                    <tr class="TableStyle-Standard-Body-Body1">
                                        <td class="TableStyle-Standard-BodyE-Column1-Body1">
                                            <p><span class="Emphasis">Client ID</span>
                                            </p>
                                        </td>
                                        <td class="TableStyle-Standard-BodyD-Column1-Body1">
                                            <p>Copy this information from the Slack app credentials</p>
                                        </td>
                                    </tr>
                                    <tr class="TableStyle-Standard-Body-Body1">
                                        <td class="TableStyle-Standard-BodyE-Column1-Body1">
                                            <p><span class="Emphasis">Client Secret</span>
                                            </p>
                                        </td>
                                        <td class="TableStyle-Standard-BodyD-Column1-Body1">
                                            <p>Copy this information from the Slack app credentials</p>
                                        </td>
                                    </tr>
                                    <tr class="TableStyle-Standard-Body-Body1">
                                        <td class="TableStyle-Standard-BodyE-Column1-Body1">
                                            <p><span class="Emphasis">Authorization URL</span>
                                            </p>
                                        </td>
                                        <td class="TableStyle-Standard-BodyD-Column1-Body1">
                                            <p><span class="Emphasis">https://slack.com/oauth/authorize</span>
                                            </p>
                                        </td>
                                    </tr>
                                    <tr class="TableStyle-Standard-Body-Body1">
                                        <td class="TableStyle-Standard-BodyE-Column1-Body1">
                                            <p><span class="Emphasis">Token URL</span>
                                            </p>
                                        </td>
                                        <td class="TableStyle-Standard-BodyD-Column1-Body1">
                                            <p><span class="Emphasis">https://slack.com/api/oauth.access</span>
                                            </p>
                                        </td>
                                    </tr>
                                    <tr class="TableStyle-Standard-Body-Body1">
                                        <td class="TableStyle-Standard-BodyE-Column1-Body1">
                                            <p><span class="Emphasis">Redirect URL</span>
                                            </p>
                                        </td>
                                        <td class="TableStyle-Standard-BodyD-Column1-Body1">
                                            <p>The redirect URL&#160;you used when configuring the Slack app (in the format &#160;<span class="Emphasis">https://&lt;identity flows url&gt;/gateway/callback</span>)</p>
                                        </td>
                                    </tr>
                                    <tr class="TableStyle-Standard-Body-Body1">
                                        <td class="TableStyle-Standard-BodyB-Column1-Body1">
                                            <p><span class="Emphasis">Scopes</span>
                                            </p>
                                        </td>
                                        <td class="TableStyle-Standard-BodyA-Column1-Body1">
                                            <p>Select <span class="Emphasis">Scopes</span>, then select the following options:</p>
                                            <ul>
                                                <li>
                                                    <p><span class="Emphasis">channels:history</span>
                                                    </p>
                                                </li>
                                                <li>
                                                    <p><span class="Emphasis">chat:write:bot</span>
                                                    </p>
                                                </li>
                                                <li>
                                                    <p><span class="Emphasis">chat:write:user</span>
                                                    </p>
                                                </li>
                                            </ul>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </li>
                        <li>
                            <p>Click <span class="Emphasis">Authorize</span>.</p>
                        </li>
                        <li>
                            <p>If the authentication flow is successful, click <span class="Emphasis">Save &amp; Use</span>.</p>
                        </li>
                    </ol>
                </li>
                <li>
                    <p>In the <span class="Emphasis">Notifications</span> component, in <span class="Emphasis">Settings </span>&gt; <span class="Emphasis">Authorizations</span>, click <span class="Emphasis">ADD NEW</span>.</p>
                </li>
                <li>
                    <p>In the <span class="Emphasis">Manage Authorizations </span>window, configure the following to create an authorization for the <MadCap:variable name="cc_product_vars.SCA-short" /> APIs:</p>
                    <ol style="list-style-type: lower-alpha;">
                        <li>
                            <p>Fill in the following fields:</p>
                            <table style="mc-table-style: url('../Resources/TableStyles/Standard.css');caption-side: top;" class="TableStyle-Standard" cellspacing="0" summary="Lists the SCA API information that has to be applied to the authorization">
                                <caption>SCA API authorization details</caption>
                                <col class="TableStyle-Standard-Column-Column1" />
                                <col class="TableStyle-Standard-Column-Column1" />
                                <thead>
                                    <tr class="TableStyle-Standard-Head-Header1">
                                        <th class="TableStyle-Standard-HeadE-Column1-Header1">
                                            <p>Item</p>
                                        </th>
                                        <th class="TableStyle-Standard-HeadD-Column1-Header1">
                                            <p>Description</p>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="TableStyle-Standard-Body-Body1">
                                        <td class="TableStyle-Standard-BodyE-Column1-Body1">
                                            <p><span class="Emphasis">Name</span>
                                            </p>
                                        </td>
                                        <td class="TableStyle-Standard-BodyD-Column1-Body1">
                                            <p>Provide a name for the server</p>
                                        </td>
                                    </tr>
                                    <tr class="TableStyle-Standard-Body-Body1">
                                        <td class="TableStyle-Standard-BodyE-Column1-Body1">
                                            <p><span class="Emphasis">Type</span>
                                            </p>
                                        </td>
                                        <td class="TableStyle-Standard-BodyD-Column1-Body1">
                                            <p>Select <span class="Emphasis">OAuth2</span></p>
                                        </td>
                                    </tr>
                                    <tr class="TableStyle-Standard-Body-Body1">
                                        <td class="TableStyle-Standard-BodyE-Column1-Body1">
                                            <p><span class="Emphasis">Flow</span>
                                            </p>
                                        </td>
                                        <td class="TableStyle-Standard-BodyD-Column1-Body1">
                                            <p>Select <span class="Emphasis">Client Credentials</span></p>
                                        </td>
                                    </tr>
                                    <tr class="TableStyle-Standard-Body-Body1">
                                        <td class="TableStyle-Standard-BodyE-Column1-Body1">
                                            <p><span class="Emphasis">Content Type</span>
                                            </p>
                                        </td>
                                        <td class="TableStyle-Standard-BodyD-Column1-Body1">
                                            <p>Select <span class="Emphasis">application/x-www-form-urlencoded</span></p>
                                        </td>
                                    </tr>
                                    <tr class="TableStyle-Standard-Body-Body1">
                                        <td class="TableStyle-Standard-BodyE-Column1-Body1">
                                            <p><span class="Emphasis">Client ID</span>
                                            </p>
                                        </td>
                                        <td class="TableStyle-Standard-BodyD-Column1-Body1">
                                            <p>Provide the username of your <MadCap:variable name="cc_product_vars.SCA-short" /> service user</p>
                                        </td>
                                    </tr>
                                    <tr class="TableStyle-Standard-Body-Body1">
                                        <td class="TableStyle-Standard-BodyE-Column1-Body1">
                                            <p><span class="Emphasis">Client Secret</span>
                                            </p>
                                        </td>
                                        <td class="TableStyle-Standard-BodyD-Column1-Body1">
                                            <p>Provide the password of your&#160;<MadCap:variable name="cc_product_vars.SCA-short" /> service user</p>
                                        </td>
                                    </tr>
                                    <tr class="TableStyle-Standard-Body-Body1">
                                        <td class="TableStyle-Standard-BodyE-Column1-Body1">
                                            <p><span class="Emphasis">Token URL</span>
                                            </p>
                                        </td>
                                        <td class="TableStyle-Standard-BodyD-Column1-Body1">
                                            <p>https://&lt;Identity url&gt;/oauth2/token/&lt;authorization application name&gt;</p>
                                        </td>
                                    </tr>
                                    <tr class="TableStyle-Standard-Body-Body1">
                                        <td class="TableStyle-Standard-BodyB-Column1-Body1">
                                            <p><span class="Emphasis">Scopes</span>
                                            </p>
                                        </td>
                                        <td class="TableStyle-Standard-BodyA-Column1-Body1">
                                            <p>Select <span class="Emphasis">Scopes</span>, then select <span class="Emphasis">sca</span></p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </li>
                        <li>
                            <p>Click <span class="Emphasis">Authorize</span>.</p>
                        </li>
                        <li>
                            <p>If the authentication flow is successful, click <span class="Emphasis">Save &amp; Use</span>.</p>
                        </li>
                    </ol>
                </li>
                <li>
                    <p>In the <span class="Emphasis">Map </span>tab, scroll down to <span class="Emphasis">channel </span>and paste the channel ID&#160;that you got when you created the dedicated Slack channel.</p>
                </li>
                <li>
                    <p>Click <span class="Emphasis">Save</span>.</p>
                </li>
            </ol>
            <h3 class="step" MadCap:autonum="Step 2: ">Test the authorization channel connection</h3>
            <p><a name="verify-flow"></a>When you finish configuring the flow, you can verify it in <MadCap:variable name="cc_product_vars.Flows-short" />.</p>
            <ol>
                <li>
                    <p>Click the Slack <span class="Emphasis">Chat Post Message</span> step in the flow, and in the menu bar, click <span class="Emphasis">Run</span>.</p>
                </li>
                <li>
                    <p>In the window that appears, type the parameter {"message": "&lt;value&gt;"} with any value, and click <span class="Emphasis">Submit</span>.</p>
                </li>
                <li>
                    <p>When the flow finishes running, click the notification icon next to your user name in the upper right corner of the window, and select the most recent results of running the flow.</p>
                </li>
                <li>
                    <p>Expand the step, then expand the API content of the step to view the message and verify that the value was passed.</p>
                </li>
            </ol>
            <h3 class="step" MadCap:autonum="Step 3: ">Set up the <MadCap:variable name="cc_product_vars.SCA-short" /> policy flow</h3>
            <p>In <MadCap:variable name="cc_product_vars.Flows-short" />, configure the components that trigger <MadCap:variable name="cc_product_vars.SCA-short" /> to create a temporary policy with the requested details.</p>
            <ol>
                <li>
                    <p>Click <span class="Emphasis">Import </span>and upload the <span class="Emphasis">SCA Ondemand Slack</span> JSON file.</p>
                </li>
                <li>
                    <p>Click <span class="Emphasis">Save</span>.</p>
                </li>
                <li>
                    <p>Configure the leftpath flow (where approval_status = true, which occurs when the access request is approved) as follows:</p>
                    <ol>
                        <li>
                            <p>In the <span class="Emphasis">Chat Update </span>component, in <span class="Emphasis">Settings </span>&gt; <span class="Emphasis">Authorizations</span>, select the Slack authorization you configured in the SCA Ondemand flow. In the <span class="Emphasis">Map</span> tab, scroll down to <span class="Emphasis">channel</span> and paste the channel&#160;ID&#160;that you got when you created the dedicated Slack channel (see<MadCap:xref href="#Create">Create a Slack channel</MadCap:xref> above).</p>
                        </li>
                        <li>
                            <p>In the <span class="Emphasis">Create Policy </span>component,  in <span class="Emphasis">Settings </span>&gt; <span class="Emphasis">Authorizations</span>, select the SCA API&#160;authorization you configured.</p>
                        </li>
                        <li>
                            <p>In the <span class="Emphasis">Get Status </span>component, in <span class="Emphasis">Settings </span>&gt; <span class="Emphasis">Authorizations</span>, select the SCA API&#160;authorization you configured. </p>
                        </li>
                        <li>
                            <p>In the <span class="Emphasis">Notifications </span>component, in <span class="Emphasis">Settings </span>&gt; <span class="Emphasis">Authorizations, </span>select the SCA API authorization you configured. </p>
                        </li>
                    </ol>
                </li>
                <li>
                    <p>Configure the rightpath flow (where approval_status = false, which occurs when the access request is rejected) as follows:</p>
                    <ol>
                        <li>
                            <p>In the <span class="Emphasis">Chat Update </span>component, in <span class="Emphasis">Settings </span>&gt; <span class="Emphasis">Authorizations</span>, select the authorization you configured in the SCA Ondemand flow, and in the <span class="Emphasis">Map </span>tab, scroll down to <span class="Emphasis">channel </span>and paste the channel ID&#160;that you got when you created the dedicated Slack channel.</p>
                        </li>
                        <li>
                            <p>In the <span class="Emphasis">Notifications </span>component, in <span class="Emphasis">Settings </span>&gt; <span class="Emphasis">Authorizations</span>, select the SCA API authorization you configured.</p>
                        </li>
                    </ol>
                </li>
            </ol>
            <h3 class="step" MadCap:autonum="Step 4: ">Test the channel connection</h3>
            <p>When you finish configuring the flow, verify it in <MadCap:variable name="cc_product_vars.Flows-short" /><a href="#verify-flow">as described above</a>.</p>
            <h3 class="step" MadCap:autonum="Step 5: ">Verify the configuration</h3>
            <MadCap:snippetBlock src="../CloudAdmin/CloudAdminSnippets/VerifyConfiguration.flsnp" />
            <h3 class="step" MadCap:autonum="Step 6: ">Select Manual or Automatic approval</h3>
            <MadCap:snippetBlock src="../CloudAdmin/CloudAdminSnippets/Automatic-Manual-Approval.flsnp" />
        </div>
    </body>
</html>